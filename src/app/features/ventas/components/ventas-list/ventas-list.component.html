<div class="card">
  <h2>Consulta de Ventas</h2>
  
  <div class="filtros-section">
    <div class="p-grid p-mb-3">
      <div class="p-col-12 p-md-4">
        <div class="p-field">
          <label for="fechaInicio">Fecha Inicio</label>
          <p-calendar 
            [(ngModel)]="fechaInicio"
            [showIcon]="true"
            dateFormat="yy-mm-dd"
            [maxDate]="maxDateCalendar"
            [appendTo]="'body'"
            [showButtonBar]="true"
            inputId="fechaInicio"
            placeholder="Seleccione fecha"
            styleClass="w-full"></p-calendar>
        </div>
      </div>
      
      <div class="p-col-12 p-md-4">
        <div class="p-field">
          <label for="fechaFin">Fecha Fin</label>
          <p-calendar 
            [(ngModel)]="fechaFin"
            [showIcon]="true"
            dateFormat="yy-mm-dd"
            [maxDate]="maxDateCalendar"
            [appendTo]="'body'"
            [showButtonBar]="true"
            inputId="fechaFin"
            placeholder="Seleccione fecha"
            styleClass="w-full"></p-calendar>
        </div>
      </div>
      
      <div class="p-col-12 p-md-4">
        <div class="p-field" style="margin-top: 1.75rem;">
          <button 
            pButton 
            type="button" 
            label="Buscar" 
            icon="pi pi-search"
            class="p-button-sm p-mr-2" 
            (click)="aplicarFiltros()"></button>
          <button 
            pButton 
            type="button" 
            label="Limpiar" 
            icon="pi pi-times"
            class="p-button-sm p-button-secondary" 
            (click)="limpiarFiltros()"></button>
        </div>
      </div>
    </div>
  </div>

  <!-- Estadística -->
  <div class="p-mb-3" *ngIf="ventas.length > 0">
    <div class="card-estadistica">
      <strong>Total de ventas en esta página:</strong> 
      <span class="total-amount">{{ calcularTotalVentas() | currency }}</span>
    </div>
  </div>

  <!-- Tabla de ventas -->
  <p-table 
    [value]="ventas"
    [lazy]="true"
    [paginator]="true"
    [rows]="rows"
    [totalRecords]="totalRecords"
    [loading]="loading"
    [(first)]="first"
    (onLazyLoad)="cargarVentas($event)"
    [rowsPerPageOptions]="[5,10,20]"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} ventas"
    styleClass="p-datatable-sm"
    [tableStyle]="{'min-width': '50rem'}">
    
    <ng-template pTemplate="header">
      <tr>
        <th>ID</th>
        <th>Fecha y Hora</th>
        <th>Medicamento</th>
        <th>Cantidad</th>
        <th>Valor Unitario</th>
        <th>Valor Total</th>
      </tr>
    </ng-template>
    
    <ng-template pTemplate="body" let-venta>
      <tr class="venta-row">
        <td>{{ venta.id }}</td>
        <td class="venta-fecha">{{ venta.fechaHora | date: 'dd/MM/yyyy HH:mm:ss' }}</td>
        <td>{{ venta.nombreMedicamento }}</td>
        <td>{{ venta.cantidad }}</td>
        <td>{{ venta.valorUnitario | currency }}</td>
        <td class="venta-total">{{ venta.valorTotal | currency }}</td>
      </tr>
    </ng-template>
    
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="6" class="text-center">
          <div class="empty-state">
            <i class="pi pi-shopping-cart"></i>
            <p>No se encontraron ventas</p>
          </div>
        </td>
      </tr>
    </ng-template>
    
    <ng-template pTemplate="summary">
      <div class="p-d-flex p-ai-center p-jc-between">
        Total de registros: {{totalRecords}}
      </div>
    </ng-template>
  </p-table>
</div>

<p-toast></p-toast>